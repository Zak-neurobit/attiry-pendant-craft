<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Frontend Debug Test</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #00ff00; }
        .log { margin: 5px 0; padding: 5px; background: #2a2a2a; border-radius: 3px; }
        .error { color: #ff6b6b; }
        .success { color: #51cf66; }
        .info { color: #74c0fc; }
    </style>
</head>
<body>
    <h1>üîç Frontend Product Loading Debug Test</h1>
    <p>This will test the same queries your frontend is making...</p>
    
    <div id="output"></div>
    
    <script type="module">
        import { createClient } from 'https://esm.sh/@supabase/supabase-js@2.45.0';
        
        const SUPABASE_URL = "https://jpbfprlpbiojfhshlhcp.supabase.co";
        const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpwYmZwcmxwYmlvamZoc2hsaGNwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMyOTg0NzEsImV4cCI6MjA2ODg3NDQ3MX0.POTXWKXfs8vMJkI7O7a1sXUbQwmXLm6bGwbrMnQOaDU";
        
        const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        const output = document.getElementById('output');
        
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `log ${type}`;
            div.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            output.appendChild(div);
            console.log(message);
        }
        
        async function testProductLoading() {
            try {
                log('üöÄ Starting frontend debug test...', 'info');
                
                // Test 1: Featured products query (exact same as frontend)
                log('üìû Testing getFeaturedProducts query...', 'info');
                const { data: featured, error: featuredError } = await supabase
                    .from('products')
                    .select('*')
                    .eq('is_featured', true)
                    .eq('is_active', true)
                    .order('featured_order', { ascending: true })
                    .order('created_at', { ascending: false })
                    .limit(4);
                
                if (featuredError) {
                    log(`‚ùå Featured products error: ${featuredError.message}`, 'error');
                    log(`‚ùå Error details: ${JSON.stringify(featuredError)}`, 'error');
                } else {
                    log(`‚úÖ Featured products success: ${featured?.length || 0} products`, 'success');
                    if (featured && featured.length > 0) {
                        featured.forEach(p => {
                            log(`   - ${p.title} ($${p.price}) - Order: ${p.featured_order}`, 'info');
                        });
                    }
                }
                
                // Test 2: Fallback query
                log('üìû Testing fallback query...', 'info');
                const { data: fallback, error: fallbackError } = await supabase
                    .from('products')
                    .select('*')
                    .eq('is_active', true)
                    .order('created_at', { ascending: false })
                    .limit(4);
                
                if (fallbackError) {
                    log(`‚ùå Fallback query error: ${fallbackError.message}`, 'error');
                } else {
                    log(`‚úÖ Fallback query success: ${fallback?.length || 0} products`, 'success');
                }
                
                // Test 3: Simulate the exact frontend conversion
                log('üîÑ Testing product conversion...', 'info');
                const productsToConvert = featured && featured.length > 0 ? featured : fallback;
                
                if (productsToConvert && productsToConvert.length > 0) {
                    const converted = productsToConvert.map(fp => {
                        log(`üîÑ Converting: ${fp.title}`, 'info');
                        return {
                            id: fp.id,
                            slug: fp.title.toLowerCase().replace(/[^\w\s-]/g, '').replace(/\s+/g, '-').trim(),
                            name: fp.title,
                            price: Number(fp.price),
                            originalPrice: fp.compare_price && Number(fp.compare_price) > Number(fp.price) ? Number(fp.compare_price) : undefined,
                            description: fp.description || '',
                            images: fp.image_urls && fp.image_urls.length > 0 ? fp.image_urls : ['/src/assets/product-gold.jpg'],
                            rating: 5,
                            reviewCount: Math.floor(Math.random() * 200) + 50,
                            isNew: new Date(fp.created_at) > new Date(Date.now() - 30 * 24 * 60 * 60 * 1000),
                            colors: fp.color_variants?.map(color => {
                                const colorMap = {
                                    'gold': 'gold',
                                    'rose_gold': 'rose-gold',
                                    'silver': 'silver',
                                    'matte_gold': 'matte-gold',
                                    'matte_silver': 'matte-silver',
                                    'vintage_copper': 'copper',
                                    'black': 'black'
                                };
                                return colorMap[color] || color;
                            }) || ['gold'],
                            category: 'custom-pendants',
                            stock: fp.stock,
                            sku: fp.sku || undefined
                        };
                    });
                    
                    log(`‚úÖ Conversion successful: ${converted.length} products converted`, 'success');
                    converted.forEach(p => {
                        log(`   - ${p.name} ($${p.price}) - Colors: ${p.colors.join(', ')}`, 'info');
                    });
                } else {
                    log('‚ùå No products to convert!', 'error');
                }
                
                log('üéØ Frontend debug test complete!', 'success');
                
            } catch (error) {
                log(`‚ùå Unexpected error: ${error.message}`, 'error');
                log(`‚ùå Stack: ${error.stack}`, 'error');
            }
        }
        
        // Run the test
        testProductLoading();
    </script>
</body>
</html>